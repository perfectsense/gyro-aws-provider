import ../init as _

aws::vpc vpc-123
    cidr-block: "10.0.0.0/16"

    tags: {
        Name: "vpc-123"
    }
end

aws::network-acl network-acl-1234
    vpc-id: $(aws::vpc vpc-123 | vpc-id)

    rule
            cidr-block: ["0.0.0.0/0"]
            protocol : "6"
            rule-action : "allow"
            rule-number : 103
            egress-rule : false
            from-port: 80
            to-port: 80
    end

    tags: {
            Name: "network-acl-1234"
    }
end

for zone, cidr in ['us-east-2a', '10.0.0.0/24', 'us-east-2b', '10.0.1.0/24']
    aws::subnet "subnet-$(zone)"
        vpc-id: $(aws::vpc vpc-123 | vpc-id)
        acl-id: $aws::network-acl network-acl-1234
        availability-zone: $(zone)
        cidr-block: $(cidr)

        tags: {
            Name: "subnet-example $(zone) $(cidr)"
        }
    end
end
